{"version":3,"sources":["index.js"],"names":[],"mappings":";AACA,IAAI,KAAK,GAAG,OAAO,CAAC,cAAc,CAAC,CAAA;AACnC,IAAI,IAAI,GAAG,OAAO,CAAC,MAAM,CAAC;;;AAAA,AAG1B,OAAO,CAAC,KAAK,GAAG,WAAW,IAAI,EAAE;AAC/B,MAAI,UAAU,GAAG,MAAM,KAAK,CAAC,OAAO,EAAE,CAAA;AACtC,QAAM,IAAI,CAAC,MAAM,CAAC,aAAa,EAAE;AAC/B,SAAK,EAAE,cAAc;AACrB,cAAU,EAAE,UAAU;GACvB,CAAC,CAAA;CACH;;;AAAA,AAGD,OAAO,CAAC,MAAM,GAAG,WAAW,IAAI,EAAE;AAChC,MAAI,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAA;AAC1B,MAAI,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,CAAA;AACpB,MAAI,IAAI,GAAG,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,EAAE,EAAE,CAAC,IAAI,CAAC,CAAA;AAC1C,MAAI,KAAK,GAAG,CAAC,CAAA;AACb,MAAI,KAAK,GAAG,IAAI,GAAG,KAAK,CAAA;;AAExB,MAAI,KAAK,EAAE;AACT,QAAI,UAAU,GAAG,KAAK,CAAC,gBAAgB,CAAC,KAAK,CAAC,CAAA;AAC9C,QAAI,QAAQ,GAAG,UAAU,CAAC,CAAC,CAAC,IAAI,EAAE,CAAA;AAClC,QAAI,MAAM,GAAG,QAAQ,CAAC,MAAM,IAAI,EAAE,CAAA;AAClC,QAAI,OAAO,GAAG,MAAM,CAAC,KAAK,CAAC,KAAK,EAAE,KAAK,GAAG,KAAK,CAAC,CAAA;;AAEhD,UAAO,IAAI,CAAC,MAAM,CAAC,eAAe,EAAE;AAClC,WAAK,EAAE,cAAc;AACrB,aAAO,EAAE,QAAQ,CAAC,IAAI;AACtB,iBAAW,EAAG,IAAI,GAAG,CAAC,AAAC;AACvB,WAAK,EAAE,MAAM,GAAG,KAAK;AACrB,eAAS,EAAE,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,MAAM,GAAG,KAAK,CAAC;AAC3C,YAAM,EAAE,OAAO;KAChB,CAAC,CAAA;GACH,MACI;AACH,QAAI,MAAM,GAAG,MAAM,KAAK,CAAC,YAAY,CAAC,CAAC,CAAC,CAAA;AACxC,QAAI,OAAO,GAAG,MAAM,CAAC,KAAK,CAAC,KAAK,EAAE,KAAK,GAAG,KAAK,CAAC,CAAA;AAChD,UAAM,IAAI,CAAC,MAAM,CAAC,eAAe,EAAE;AACjC,WAAK,EAAE,cAAc;AACrB,aAAO,EAAE,CAAC;AACV,iBAAW,EAAG,IAAI,GAAG,CAAC,AAAC;AACvB,WAAK,EAAE,IAAI,GAAG,CAAC;AACf,eAAS,EAAE,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,MAAM,GAAG,KAAK,CAAC;AAC3C,YAAM,EAAE,OAAO;KAChB,CAAC,CAAA;GACH;CACF,CAAA","file":"index-compiled.js","sourcesContent":["\r\nvar Movie = require('../api/movie')\r\nvar path = require('path')\r\n\r\n// index page\r\nexports.index = function *(next) {\r\n  var categories = yield Movie.findAll()\r\n  yield this.render('pages/index', {\r\n    title: 'yuanMovie 首页',\r\n    categories: categories\r\n  })\r\n}\r\n\r\n// search page\r\nexports.search = function *(next) {\r\n  var catId = this.query.cat\r\n  var q = this.query.q\r\n  var page = parseInt(this.query.p, 10) || 0\r\n  var count = 3\r\n  var index = page * count\r\n\r\n  if (catId) {\r\n    var categories = Movie.searchByCategory(catId)\r\n    var category = categories[0] || {}\r\n    var movies = category.movies || []\r\n    var results = movies.slice(index, index + count)\r\n\r\n    yield  this.render('pages/results', {\r\n      title: 'imooc 结果列表页面',\r\n      keyword: category.name,\r\n      currentPage: (page + 1),\r\n      query: 'cat=' + catId,\r\n      totalPage: Math.ceil(movies.length / count),\r\n      movies: results\r\n    })\r\n  }\r\n  else {\r\n    var movies = yield Movie.searchByName(q)\r\n    var results = movies.slice(index, index + count)\r\n    yield this.render('pages/results', {\r\n      title: 'imooc 结果列表页面',\r\n      keyword: q,\r\n      currentPage: (page + 1),\r\n      query: 'q=' + q,\r\n      totalPage: Math.ceil(movies.length / count),\r\n      movies: results\r\n    })\r\n  }\r\n}"]}