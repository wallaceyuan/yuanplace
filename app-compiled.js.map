{"version":3,"sources":["app.js"],"names":[],"mappings":"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","file":"app-compiled.js","sourcesContent":["/**\r\n * Created by Yuan on 2016/6/28.\r\n */\r\n'use strict'\r\nvar Koa = require('koa');\r\nvar fs = require('fs')\r\nvar app = new Koa();\r\nvar path = require('path');\r\nvar session = require('koa-session')\r\nvar mongoose = require('mongoose')\r\nvar bodyParser = require('koa-bodyparser');\r\nvar views = require('koa-views')\r\nvar Router = require('koa-router');\r\nvar router = new Router()\r\nvar moment = require('moment')\r\nvar staticServer = require('koa-static');\r\nvar conf = require('./config/conf')\r\nvar pool = conf.pool\r\nvar p = conf.p\r\n// models loading\r\nvar dbUrl = 'mongodb://localhost/movie'\r\nmongoose.connect(dbUrl)\r\n\r\nvar models_path = __dirname + '/app/models'\r\n\r\nvar walk = function(path) {\r\n    fs\r\n        .readdirSync(path)\r\n        .forEach(function(file) {\r\n            var newPath = path + '/' + file\r\n            var stat = fs.statSync(newPath)\r\n\r\n            if (stat.isFile()) {\r\n                if (/(.*)\\.(js|coffee)/.test(file)) {\r\n                    require(newPath)\r\n                }\r\n            }\r\n            else if (stat.isDirectory()) {\r\n                walk(newPath)\r\n            }\r\n        })\r\n}\r\nwalk(models_path)\r\n\r\n\r\nvar User = mongoose.model('User')\r\n\r\n//视图\r\napp.use(views(__dirname + '/app/views',{\r\n    extension:'jade',\r\n    locals:{\r\n        moment:moment\r\n    }\r\n}))\r\napp.use(staticServer(path.join(__dirname, 'public')));\r\n\r\n\r\n//session\r\napp.keys = ['some secret hurr'];\r\napp.use(session(app));\r\napp.use(bodyParser());\r\n\r\napp.use(function *(next){\r\n    var user = this.session.user\r\n    if(user && user.id){\r\n        var res = yield p.query('select id,name,password from users where id = ? limit 1',[user.id])\r\n        this.state.user = this.session.user = res[0]\r\n    }else{\r\n        this.state.user = null\r\n    }\r\n    yield next\r\n})\r\n\r\n\r\n//路由\r\nrequire('./config/routes')(router)\r\n\r\napp\r\n    .use(router.routes())\r\n    .use(router.allowedMethods())\r\n\r\napp.listen(3000);\r\n\r\nconsole.log('Listening');\r\n\r\n\r\n"]}